(async()=>{!function(){Object.defineProperty(window,"sceditor",{get:()=>{},set:()=>{},configurable:!1});const t=window.requestIdleCallback;window.requestIdleCallback=function(e,n){const o=e.toString();return o.includes("sceditor")||o.includes("initSceditor")?0:t.call(window,e,n)},window.initSceditor=()=>{},window.tryInit=()=>{}}(),window.initSceditor=()=>{},window.tryInit=()=>{};if(window.jQuery&&(window.jQuery.fn.sceditor=function(){return this}),window.masterDevAssistantLoaded)return;window.masterDevAssistantLoaded=!0;class t{constructor(t){this.quillInstances=t,this.bubble=null,this.currentSelection="",this.currentMeta=null,this.createBubble(),this.initListeners()}createBubble(){document.querySelector(".master-quote-bubble")||(this.bubble=document.createElement("div"),this.bubble.className="master-quote-bubble",this.bubble.innerHTML='<button class="master-quote-btn"><span>‚ùù</span> –¶–∏—Ç–∏—Ä–æ–≤–∞—Ç—å</button>',document.body.appendChild(this.bubble),this.bubble.onmousedown=t=>{t.preventDefault(),t.stopPropagation(),this.executeQuote()})}initListeners(){document.addEventListener("mouseup",t=>{this.killOriginalButtons(),setTimeout(()=>this.handleSelection(t),20)}),document.addEventListener("mousedown",t=>{this.bubble&&!this.bubble.contains(t.target)&&this.hideBubble()})}killOriginalButtons(){[".selection-sharer",".quote-selected","#quote_btn",".bit-quote-icon"].forEach(t=>document.querySelectorAll(t).forEach(t=>t.remove()))}handleSelection(t){const e=window.getSelection(),n=e.toString().trim();if(n.length>2){const o=t.target.closest(".msg-received, .msg-sent, .msg-text, pre");if(o){const t=e.getRangeAt(0).getBoundingClientRect();this.currentSelection=n,this.currentMeta=this.extractMeta(o.closest(".msg-received, .msg-sent")||o),this.showBubble(t)}}else this.hideBubble()}extractMeta(t){const e=t.classList.contains("msg-sent"),n=document.querySelector(".box-content-page h1"),o=n?n.innerText.replace("–î–∏–∞–ª–æ–≥ —Å","").trim():"–ö–ª–∏–µ–Ω—Ç";return{author:e?"–í—ã":o,date:t.querySelector(".msg-date")?.innerText.trim()||(new Date).toLocaleTimeString()}}showBubble(t){this.bubble.parentElement||document.body.appendChild(this.bubble);const e=window.pageYOffset;this.bubble.style.top=t.top+e-55+"px",this.bubble.style.left=t.left+t.width/2-60+"px",this.bubble.classList.add("active")}hideBubble(){this.bubble&&this.bubble.classList.remove("active")}async executeQuote(){const t=this.quillInstances.new_msg;if(!t)return;const e=this.currentMeta,n=`<blockquote><span class="quote-author-header"><b>${e.author} (${e.date}):</b></span><br><span>${this.currentSelection}</span></blockquote><p><br></p>`;this.animateFlight();const o=t.getSelection(!0)||{index:t.getLength(),length:0};t.clipboard.dangerouslyPasteHTML(o.index,n,"api"),document.getElementById("master-root-new_msg")?.scrollIntoView({behavior:"smooth",block:"center"}),t.focus(),this.hideBubble(),window.getSelection().removeAllRanges()}animateFlight(){const t=document.createElement("div");t.className="flying-text",t.innerText="‚ùù",t.style.top=this.bubble.offsetTop+"px",t.style.left=this.bubble.offsetLeft+"px",document.body.appendChild(t),requestAnimationFrame(()=>{t.style.top="100px",t.style.opacity="0",t.style.transform="scale(3) rotate(360deg)"}),setTimeout(()=>t.remove(),700)}}class e{constructor(){"undefined"!=typeof hljs&&hljs.configure({ignoreUnescapedHTML:!0})}init(){"undefined"!=typeof hljs&&this.highlightAll()}highlightAll(){document.querySelectorAll(".msg-text").forEach(t=>{t.querySelectorAll("pre").forEach(t=>{if(t.dataset.highlighted)return;let e=t.textContent.trim().replace(/^["']|["']$/g,"");if(e&&!(e.length<5))try{let n;const o=hljs.getLanguage("php"),i=e.includes("public function")||e.includes("$this->")||e.includes("foreach ($")||e.includes("protected $");o&&i&&!e.includes("<?")?(n=hljs.highlight("<?php "+e,{language:"php"}),n.value=n.value.replace(/^.*?(&lt;\?php|&lt;\?)\s*/i,"")):n=hljs.highlightAuto(e,["php","sql","twig","javascript","xml","css","json"]);const s=n.language||"plaintext";t.innerHTML="",t.classList.add("hljs");const r=document.createElement("code");r.className=`hljs language-${s}`,r.innerHTML=n.value,t.appendChild(r),t.dataset.highlighted="true",this.addCopyButton(t,e),this.addBadge(t,s)}catch(e){t.dataset.highlighted="true"}})})}addBadge(t,e){const n=document.createElement("div");n.className="code-lang-badge",n.innerText=e.length<4?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1),t.appendChild(n)}addCopyButton(t,e){const n=document.createElement("button");n.className="code-copy-btn",n.innerText="Copy",n.onclick=t=>{t.preventDefault(),navigator.clipboard.writeText(e).then(()=>{n.innerText="Done!",n.style.background="#01A121",n.style.color="white",setTimeout(()=>{n.innerText="Copy",n.style.background="",n.style.color=""},2e3)})},t.appendChild(n)}}class n{constructor(t,e){this.quill=t,this.uploadCallback=e,this.initListeners()}handleFiles(t,e){if(!t||0===t.length)return;const n=e||this.quill.getSelection(!0)||{index:this.quill.getLength(),length:0};Array.from(t).forEach(t=>{t.type.startsWith("image/")&&this.readSync(t,n)})}initListeners(){const t=this.quill.root,e={capture:!0,passive:!1};t.addEventListener("dragover",e=>{(t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()})(e),t.classList.add("dragging-over")},e),t.addEventListener("dragleave",()=>{t.classList.remove("dragging-over")},e),t.addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),t.classList.remove("dragging-over");const n=this.getDropIndex(e),o=e.dataTransfer.files;this.handleFiles(o,n)},{capture:!0,passive:!1}),t.addEventListener("paste",t=>{const e=t.clipboardData||window.clipboardData;if(e&&e.items.length>0){if(Array.from(e.items).some(t=>t.type.includes("image"))){t.preventDefault(),t.stopPropagation();const n=this.quill.getSelection(!0)||{index:this.quill.getLength(),length:0},o=Array.from(e.items).filter(t=>"file"===t.kind&&t.type.startsWith("image/")).map(t=>t.getAsFile());this.handleFiles(o,n)}}},{capture:!0,passive:!1})}readSync(t,e){const n=new FileReader;n.onload=t=>{const n=t.target.result;!n||n.length<100||this.openEditor(n,e)},n.readAsDataURL(t)}openEditor(t,e){if(void 0===i)return;new i(async t=>{this.quill.insertText(e.index,"[–ó–∞–≥—Ä—É–∑–∫–∞...]",{italic:!0,color:"#01A121"});const n=await this.uploadCallback(t);this.quill.deleteText(e.index,13),n&&(this.quill.insertEmbed(e.index,"image",n),this.quill.setSelection(e.index+1))}).open(t)}getDropIndex(t){let e=this.quill.getLength();if(document.caretRangeFromPoint){const n=document.caretRangeFromPoint(t.clientX,t.clientY);if(n&&n.startContainer){const t=this.quill.scroll.find(n.startContainer);t&&(e=t.offset(this.quill.scroll),"function"==typeof t.index&&(e+=t.index(n.startContainer,n.startOffset)))}}return{index:e,length:0}}}class o{constructor(t,e){this.quill=t,this.onSelect=e,this.menu=null,this.selectedIndex=0,this.options=[{id:"reply",label:"–í–µ–∂–ª–∏–≤—ã–π –æ—Ç–≤–µ—Ç",icon:"‚úçÔ∏è",task:"–ü—Ä–µ–¥–ª–æ–∂–∏ –≤–µ–∂–ª–∏–≤—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞"},{id:"fix",label:"–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏ —É–ª—É—á—à–∏—Ç—å",icon:"‚ú®",task:"–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≥—Ä–∞–º–º–∞—Ç–∏–∫—É –∏ —Å–¥–µ–ª–∞—Ç—å —Ç–µ–∫—Å—Ç –±–æ–ª–µ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º"},{id:"logs",label:"–ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫",icon:"üîç",task:"–ù–∞–π–¥–∏ –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏ –≤ —ç—Ç–æ–º —Ç–µ–∫—Å—Ç–µ –∏ –ø—Ä–µ–¥–ª–æ–∂–∏ —Ä–µ—à–µ–Ω–∏–µ"},{id:"trans",label:"–ù–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π (PRO)",icon:"üá¨üáß",task:"–ü–µ—Ä–µ–≤–µ–¥–∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫"}],this.handleKeyDown=this.handleKeyDown.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this)}show(){if(this.menu)return;this.selectedIndex=0;const t=this.quill.getSelection();if(!t)return;const e=this.quill.getBounds(t.index);this.menu=document.createElement("div"),this.menu.className="ai-slash-menu",this.menu.style.zIndex="10005",this.menu.style.top=e.bottom+10+"px",this.menu.style.left=e.left+"px",this.renderItems(),this.quill.container.appendChild(this.menu),document.addEventListener("keydown",this.handleKeyDown,!0),setTimeout(()=>{document.addEventListener("mousedown",this.handleClickOutside,!0)},10)}handleClickOutside(t){this.menu&&!this.menu.contains(t.target)&&this.hide()}renderItems(){if(!this.menu)return;let t='<div class="ai-menu-header">AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</div>';this.options.forEach((e,n)=>{const o=n===this.selectedIndex;t+=`\n                    <div class="ai-menu-item ${o?"selected":""}" data-index="${n}">\n                        <span>${e.icon}</span> ${e.label}\n                    </div>`}),this.menu.innerHTML=t,this.menu.querySelectorAll(".ai-menu-item").forEach(t=>{t.onmousedown=e=>{e.preventDefault(),e.stopPropagation(),this.selectedIndex=parseInt(t.dataset.index),this.confirmSelection()}})}hide(){this.menu&&(this.menu.remove(),this.menu=null),document.removeEventListener("keydown",this.handleKeyDown,!0),document.removeEventListener("mousedown",this.handleClickOutside,!0)}confirmSelection(){const t=this.options[this.selectedIndex];this.hide(),t&&this.onSelect(t)}handleKeyDown(t){this.menu&&(["ArrowDown","ArrowUp","Enter","Escape"].includes(t.key)&&(t.preventDefault(),t.stopImmediatePropagation()),"ArrowDown"===t.key?(this.selectedIndex=(this.selectedIndex+1)%this.options.length,this.renderItems()):"ArrowUp"===t.key?(this.selectedIndex=(this.selectedIndex-1+this.options.length)%this.options.length,this.renderItems()):"Enter"===t.key?this.confirmSelection():"Escape"===t.key&&this.hide())}}class i{constructor(t){this.onSave=t,this.canvas=null,this.ctx=null,this.tool="arrow",this.isDrawing=!1,this.startX=0,this.startY=0,this.image=null,this.history=[]}open(t){const e=new Image;e.onload=()=>{this.image=e,this.renderUI(),this.initCanvas()},e.onerror=t=>{},e.src=t}renderUI(){const t=document.createElement("div");t.id="master-screenshot-overlay",t.innerHTML='\n                <div class="screenshot-toolbar">\n                    <div class="screenshot-tool active" data-tool="arrow">‚Üó –°—Ç—Ä–µ–ª–∫–∞</div>\n                    <div class="screenshot-tool" data-tool="rect">‚¨ú –ö–≤–∞–¥—Ä–∞—Ç</div>\n                    <div class="screenshot-tool" data-tool="blur">üå´ –†–∞–∑–º—ã—Ç–∏–µ (Blur)</div>\n                    <div style="border-left: 1px solid #444; height: 20px; margin: 0 10px;"></div>\n                    <span style="font-size: 12px; color: #aaa;">–†–∏—Å—É–π—Ç–µ –º—ã—à–∫–æ–π –Ω–∞ —Ñ–æ—Ç–æ</span>\n                </div>\n                <canvas id="screenshot-canvas"></canvas>\n                <div class="screenshot-actions">\n                    <button class="btn-cancel">–û—Ç–º–µ–Ω–∞</button>\n                    <button class="btn-save">–ì–æ—Ç–æ–≤–æ, –∑–∞–≥—Ä—É–∑–∏—Ç—å!</button>\n                </div>\n            ',document.body.appendChild(t),t.querySelectorAll(".screenshot-tool").forEach(e=>{e.onclick=()=>{t.querySelectorAll(".screenshot-tool").forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.tool=e.dataset.tool}}),t.querySelector(".btn-cancel").onclick=()=>t.remove(),t.querySelector(".btn-save").onclick=()=>{const e=this.canvas.toDataURL("image/jpeg",.9).split(",")[1];this.onSave(e),t.remove()}}initCanvas(){this.canvas=document.getElementById("screenshot-canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.image.width,this.canvas.height=this.image.height,this.ctx.drawImage(this.image,0,0),this.saveHistory(),this.canvas.onmousedown=t=>this.startDrawing(t),this.canvas.onmousemove=t=>this.draw(t),this.canvas.onmouseup=()=>this.stopDrawing()}saveHistory(){this.history.push(this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height))}startDrawing(t){this.isDrawing=!0;const e=this.canvas.getBoundingClientRect();this.startX=(t.clientX-e.left)*(this.canvas.width/e.width),this.startY=(t.clientY-e.top)*(this.canvas.height/e.height)}draw(t){if(!this.isDrawing)return;const e=this.canvas.getBoundingClientRect(),n=(t.clientX-e.left)*(this.canvas.width/e.width),o=(t.clientY-e.top)*(this.canvas.height/e.height);this.ctx.putImageData(this.history[this.history.length-1],0,0),this.ctx.strokeStyle="#ff0000",this.ctx.lineWidth=5,this.ctx.lineJoin="round",this.ctx.lineCap="round","arrow"===this.tool?this.drawArrow(this.startX,this.startY,n,o):"rect"===this.tool?this.ctx.strokeRect(this.startX,this.startY,n-this.startX,o-this.startY):"blur"===this.tool&&this.applyBlur(this.startX,this.startY,n-this.startX,o-this.startY)}stopDrawing(){this.isDrawing&&this.saveHistory(),this.isDrawing=!1}drawArrow(t,e,n,o){const i=Math.atan2(o-e,n-t);this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(n,o),this.ctx.lineTo(n-20*Math.cos(i-Math.PI/6),o-20*Math.sin(i-Math.PI/6)),this.ctx.moveTo(n,o),this.ctx.lineTo(n-20*Math.cos(i+Math.PI/6),o-20*Math.sin(i+Math.PI/6)),this.ctx.stroke()}applyBlur(t,e,n,o){this.ctx.save(),this.ctx.filter="blur(10px)",this.ctx.drawImage(this.canvas,t,e,n,o,t,e,n,o),this.ctx.restore()}}const s=Quill.import("delta"),r=Quill.import("formats/video");let a;Quill.register(class extends r{static create(t){let e=t.url||t;if(e.includes("youtube.com/watch?v="))e=e.replace("watch?v=","embed/").split("&")[0];else if(e.includes("youtu.be/")){const t=e.split("/").pop().split("?")[0];e=`https://www.youtube.com/embed/${t}`}if(e.includes("rutube.ru/video/")&&(e=e.replace("rutube.ru/video/","rutube.ru/play/embed/")),e.includes("vimeo.com/")&&!e.includes("player.vimeo.com")){const t=e.split("/").pop().split("?")[0];e=`https://player.vimeo.com/video/${t}`}let n=super.create(e);return n.setAttribute("src",e),n.setAttribute("width","100%"),n.setAttribute("height","350"),n.setAttribute("frameborder","0"),n.setAttribute("allowfullscreen","true"),n}},!0);const l={};try{const t=chrome.runtime.getURL("pkg/liveopencart_assistant_bg.wasm"),e=await import(chrome.runtime.getURL("pkg/liveopencart_assistant.js"));await e.default({module_or_path:t}),a=e.Converter}catch(t){return}const c=document.createElement("link");async function d(t){if(!chrome.runtime?.id)return alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5). –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –±—ã–ª –ø–æ—Ç–µ—Ä—è–Ω."),null;const e=t.includes(",")?t.split(",")[1]:t;return new Promise(t=>{chrome.runtime.sendMessage({type:"UPLOAD_IMAGE",payload:e},e=>{chrome.runtime.lastError?t(null):e&&e.success?t(e.url):t(null)})})}c.rel="stylesheet",c.href=chrome.runtime.getURL("assets/quill.snow.css"),document.head.appendChild(c);function p(){const t=["¬´–ù–∏—á—Ç–æ –Ω–µ –æ–±—Ö–æ–¥–∏—Ç—Å—è –Ω–∞–º —Ç–∞–∫ –¥–µ—à–µ–≤–æ –∏ –Ω–µ —Ü–µ–Ω–∏—Ç—Å—è —Ç–∞–∫ –¥–æ—Ä–æ–≥–æ, –∫–∞–∫ –≤–µ–∂–ª–∏–≤–æ—Å—Ç—å¬ª. (–°–µ—Ä–≤–∞–Ω—Ç–µ—Å)","¬´–í–µ–∂–ª–∏–≤–æ—Å—Ç—å ‚Äî –∏—Å–∫—É—Å—Å—Ç–≤–æ –≤—ã–±–∏—Ä–∞—Ç—å –∏–∑ —Å–≤–æ–∏—Ö –º—ã—Å–ª–µ–π —Å–∞–º—ã–µ –ª—É—á—à–∏–µ¬ª.","¬´–í–µ–∂–ª–∏–≤–æ—Å—Ç—å ‚Äî –ª—É—á—à–∏–π –ø–∞—Ç—á –¥–ª—è –ª—é–±–æ–≥–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞¬ª.","¬´–•–æ—Ä–æ—à–∏–µ –º–∞–Ω–µ—Ä—ã ‚Äî –ª—É—á—à–∏–π –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –≤–∞—à–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π¬ª.","¬´–ë—É–¥—å—Ç–µ –≤–µ–∂–ª–∏–≤—ã —Å –∫–∞–∂–¥—ã–º. –í—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ, –∫—Ç–æ –≤–∞—à —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–∫–∞–∑—á–∏–∫¬ª."];return t[Math.floor(Math.random()*t.length)]}function h(t,e){const n=document.querySelector(".box-content-page h1, #content h1"),o=n?n.innerText.replace("–î–∏–∞–ª–æ–≥ —Å","").trim():"–ö–ª–∏–µ–Ω—Ç",i=t.getSelection(!0);t.clipboard.dangerouslyPasteHTML(i.index,a.get_template(e,o))}const u={getCustomerName(){const t=document.querySelector(".box-content-page h1");return t?t.innerText.replace("–î–∏–∞–ª–æ–≥ —Å","").trim():"–ö–ª–∏–µ–Ω—Ç"},getHistory(t=10){const e=[];return document.querySelectorAll(".msg-sent, .msg-received").forEach(t=>{const n=t.classList.contains("msg-sent"),o=t.querySelector(".msg-text").innerText.trim(),i=t.querySelector(".msg-date").innerText.trim();e.push({role:n?"assistant":"user",content:o,date:i})}),e.slice(-t)},getContactId(){const t=document.querySelector('input[name="contact_id"]');return t?t.value:null}};function m(t,e,n){const o=chrome.runtime.connect({name:"ai-stream"});o.postMessage({type:"ASK_AI_STREAM",payload:t}),o.onMessage.addListener(t=>{"CHUNK"===t.type?e(t.text):"DONE"===t.type?(n(),o.disconnect()):"ERROR"===t.type&&o.disconnect()})}!function(){const t=document.createElement("style");t.textContent="\n            .content, .july-white, #content { height: auto !important; min-height: 0 !important; padding-top: 10px !important; }\n            form#form { display: flex; flex-direction: column; padding: 0 15px; }\n            .content h2 { font-family: sans-serif; font-size: 14px !important; font-weight: 700 !important; color: #555 !important; text-transform: uppercase; margin: 10px 0 20px 5px !important; border-left: 4px solid #01A121; padding-left: 15px !important; }\n            .master-editor-container { order: -1; margin: 0 0 25px 0 !important; border: 1px solid #d1d1d1; border-radius: 10px; background: #fff; position: relative; z-index: 10; width: 100% !important; box-shadow: 0 5px 20px rgba(0,0,0,0.05); display: flex; flex-direction: column; }\n            .ql-toolbar.ql-snow { border: none !important; border-bottom: 1px solid #f0f0f0 !important; padding: 12px 15px !important; display: flex; flex-wrap: wrap; gap: 6px; background: #fafafa; border-radius: 10px 10px 0 0; }\n            .ql-template-bug, .ql-template-access, .ql-template-audit, .ql-template-hub { width: auto !important; padding: 0 12px !important; border-radius: 6px !important; border: 1px solid #e0e0e0 !important; display: inline-flex !important; align-items: center; font-size: 11px !important; height: 28px !important; cursor: pointer; background: #fff !important; transition: all 0.2s; }\n            .ql-template-bug::before { content: '‚ö°'; margin-right: 6px; } .ql-template-bug::after { content: 'BUG'; color: #d32f2f; font-weight: bold; }\n            .ql-template-access::before { content: '‚öñ'; margin-right: 6px; } .ql-template-access::after { content: 'ACCESS'; color: #1976d2; font-weight: bold; }\n            .ql-template-audit::before { content: '‚öô'; margin-right: 6px; } .ql-template-audit::after { content: '–ê–£–î–ò–¢'; color: #ff9800; font-weight: bold; }\n            .ql-template-hub::before { content: '‚úâ'; margin-right: 6px; } .ql-template-hub::after { content: 'HUB'; color: #388e3c; font-weight: bold; }\n            .ql-product-search::after { content: 'üõí'; font-size: 16px; cursor: pointer; }\n            .ql-night-mode::after { content: 'üåô'; font-size: 16px; cursor: pointer; }\n            .product-search-popup { position: absolute; top: 60px; left: 50%; transform: translateX(-50%); width: 350px; background: white; border: 1px solid #ccc; box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 10002; border-radius: 8px; padding: 10px; }\n            #ps-input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 8px; outline: none; box-sizing: border-box; }\n            #ps-results { max-height: 200px; overflow-y: auto; }\n            .ps-item { padding: 8px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 13px; }\n            .ps-item:hover { background: #f0f7f0; color: #01A121; }\n            .master-emoji-bar { background: #fdfdfd; border-top: 1px solid #f0f0f0; padding: 12px 20px; display: flex; flex-wrap: wrap; gap: 15px; border-radius: 0 0 10px 10px; }\n            .emoji-item { font-size: 24px; cursor: pointer; user-select: none; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }\n            .emoji-item:hover { transform: scale(1.7) translateY(-8px); }\n            .dark .master-editor-container { background: #1e1e1e; border-color: #444; }\n            .dark .ql-toolbar { background: #2d2d2d !important; border-bottom-color: #444 !important; }\n            .dark .ql-editor { background: #1e1e1e !important; color: #eee !important; }\n            .dark .master-emoji-bar { background: #252525; border-top-color: #444; }\n            .ql-editor { font-size: 15px; line-height: 1.7; padding: 20px !important; }\n            .ql-snow .ql-tooltip:not(.ql-hidden) { z-index: 10000 !important; background: #fff !important; border: 1px solid #999 !important; box-shadow: 0 4px 15px rgba(0,0,0,0.3) !important; border-radius: 4px !important; padding: 12px !important; left: 20px !important; display: flex !important; align-items: center; gap: 8px; }\n            .ql-snow .ql-tooltip.ql-hidden { display: none !important; }\n            .sceditor-container, .sceditor-toolbar, .wysibb { display: none !important; height: 0 !important; margin: 0 !important; padding: 0 !important; }\n            .dragging-over { background-color: #f0faff !important; border: 2px dashed #01A121 !important; }\n\n            /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç-—Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */\n            #master-screenshot-overlay {\n                position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n                background: rgba(0,0,0,0.85); z-index: 20000;\n                display: flex; flex-direction: column; align-items: center; justify-content: center;\n            }\n            .screenshot-toolbar {\n                background: #222; padding: 10px; border-radius: 8px; margin-bottom: 10px;\n                display: flex; gap: 15px; color: white; align-items: center;\n            }\n            .screenshot-tool {\n                cursor: pointer; padding: 5px 10px; border-radius: 4px; border: 1px solid #444;\n            }\n            .screenshot-tool.active { background: #01A121; border-color: #01A121; }\n            .screenshot-tool:hover { background: #333; }\n            #screenshot-canvas { \n                max-width: 90vw; max-height: 80vh; background: white; \n                box-shadow: 0 0 30px rgba(0,0,0,0.5); cursor: crosshair;\n            }\n            .screenshot-actions { margin-top: 15px; display: flex; gap: 10px; }\n            .btn-save { background: #01A121; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; border: none; font-weight: bold; }\n            .btn-cancel { background: #444; color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; border: none; }\n            \n            .ql-ai-assist::after {\n                content: 'ü§ñ';\n                font-size: 16px;\n            }\n\n            .ai-slash-menu {\n                position: absolute; background: #fff; border: 1px solid #ddd;\n                box-shadow: 0 8px 24px rgba(0,0,0,0.15); border-radius: 8px;\n                z-index: 10001; width: 220px; overflow: hidden; font-family: sans-serif;\n            }\n\n            .ai-menu-item {\n                padding: 10px 15px; cursor: pointer; display: flex; align-items: center; gap: 10px;\n                transition: all 0.1s; font-size: 13px; color: #333; border-left: 3px solid transparent;\n            }\n            .ai-menu-item.selected, .ai-menu-item:hover {\n                background: #f0f7f0; color: #01A121; border-left-color: #01A121; outline: none;\n            }\n            .ai-menu-header {\n                background: #fafafa; padding: 8px 15px; font-size: 9px; letter-spacing: 0.5px;\n                text-transform: uppercase; color: #aaa; border-bottom: 1px solid #eee;\n            }\n\n            /* --- –ë–õ–û–ö–ò–†–û–í–ö–ê –°–ò–°–¢–ï–ú–ù–û–ì–û –¶–ò–¢–ò–†–û–í–ê–ù–ò–Ø –°–ê–ô–¢–ê --- */\n            .quote-selected, #quote_btn, .bit-quote-icon, [title=\"–¶–∏—Ç–∏—Ä–æ–≤–∞—Ç—å\"], .selection-sharer { \n                display: none !important; visibility: hidden !important; opacity: 0 !important; pointer-events: none !important; \n            }\n\n            /* --- MAGIC QUOTE BUBBLE (MASTER VERSION) --- */\n            .master-quote-bubble {\n                position: absolute;\n                z-index: 100005;\n                background: rgba(255, 255, 255, 0.9);\n                backdrop-filter: blur(10px);\n                -webkit-backdrop-filter: blur(10px);\n                border: 1px solid #01A121;\n                border-radius: 50px;\n                padding: 4px;\n                display: flex;\n                align-items: center;\n                box-shadow: 0 8px 25px rgba(0,0,0,0.2);\n                transform: translateY(10px) scale(0.9);\n                opacity: 0;\n                pointer-events: none;\n                transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n                user-select: none;\n            }\n\n            .master-quote-bubble.active {\n                transform: translateY(0) scale(1);\n                opacity: 1;\n                pointer-events: all;\n            }\n\n            .master-quote-btn {\n                background: #01A121;\n                color: white;\n                border: none;\n                border-radius: 20px;\n                padding: 6px 16px;\n                font-size: 13px;\n                font-weight: bold;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                transition: background 0.2s, transform 0.1s;\n            }\n\n            .master-quote-btn:hover { background: #018a1c; transform: translateY(-1px); }\n            .master-quote-btn:active { transform: scale(0.95); }\n\n            /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª–µ—Ç–∞ */\n            .flying-text {\n                position: fixed;\n                z-index: 100006;\n                color: #01A121;\n                font-weight: bold;\n                pointer-events: none;\n                transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);\n                opacity: 0.8;\n            }\n\n            /* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å —Ü–∏—Ç–∞—Ç—ã –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ */\n            .ql-editor blockquote {\n                border-left: 4px solid #01A121 !important;\n                background: rgba(1, 161, 33, 0.05) !important;\n                padding: 12px 16px !important;\n                border-radius: 0 8px 8px 0 !important;\n                margin: 10px 0 !important;\n                font-style: normal !important;\n                position: relative;\n            }\n\n            /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–∏ —Ü–∏—Ç–∞—Ç—ã */\n            .quote-author-header {\n                color: #01A121;\n                font-weight: 800;\n                font-size: 0.85em;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n                display: block;\n                margin-bottom: 4px;\n                border-bottom: 1px dashed rgba(1, 161, 33, 0.2);\n                padding-bottom: 4px;\n            }\n\n            .quote-date {\n                font-weight: 400;\n                color: #888;\n                margin-left: 8px;\n                text-transform: none;\n            }\n\n            /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–¥–∞ */\n        .msg-text pre.hljs {\n            background: #282c34 !important;\n            padding: 0 !important;\n            border-radius: 8px !important;\n            border: 1px solid #181a1f !important;\n            position: relative !important;\n            margin: 15px 0 !important;\n            overflow: hidden !important;\n        }\n\n        /* –¢–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ */\n        .msg-text pre.hljs code {\n            display: block !important;\n            padding: 15px 20px !important;\n            color: #abb2bf !important;\n            font-family: 'Fira Code', 'Consolas', monospace !important;\n            font-size: 13px !important;\n            line-height: 1.6 !important;\n            white-space: pre !important;\n            background: transparent !important;\n        }\n\n        /* –¶–≤–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ (One Dark Palette) */\n        .hljs-keyword, .hljs-selector-tag { color: #c678dd !important; } /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π */\n        .hljs-string, .hljs-regexp, .hljs-addition { color: #98c379 !important; } /* –ó–µ–ª–µ–Ω—ã–π */\n        .hljs-function, .hljs-title, .hljs-section { color: #61afef !important; } /* –°–∏–Ω–∏–π */\n        .hljs-variable, .hljs-template-variable { color: #e06c75 !important; } /* –ö—Ä–∞—Å–Ω—ã–π */\n        .hljs-comment, .hljs-quote { color: #5c6370 !important; font-style: italic !important; } /* –°–µ—Ä—ã–π */\n        .hljs-number, .hljs-literal, .hljs-attr, .hljs-attribute { color: #d19a66 !important; } /* –û—Ä–∞–Ω–∂–µ–≤—ã–π */\n        .hljs-type, .hljs-built_in, .hljs-params { color: #e5c07b !important; } /* –ñ–µ–ª—Ç—ã–π/–ë–µ–∂–µ–≤—ã–π */\n\n        /* –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è */\n        .code-copy-btn {\n            position: absolute; top: 10px; right: 10px;\n            background: rgba(255,255,255,0.05); color: #888;\n            border: 1px solid rgba(255,255,255,0.1); border-radius: 4px;\n            padding: 4px 10px; font-size: 11px; cursor: pointer;\n            transition: all 0.2s; opacity: 0; z-index: 10;\n        }\n        .msg-text pre.hljs:hover .code-copy-btn { opacity: 1; }\n        .code-copy-btn:hover { background: #01A121 !important; color: white !important; border-color: #01A121 !important; }\n\n        /* –ë–µ–π–¥–∂ —è–∑—ã–∫–∞ */\n        .code-lang-badge {\n            position: absolute; bottom: 5px; right: 10px;\n            font-size: 10px; color: #5c6370; font-weight: bold;\n            text-transform: uppercase; pointer-events: none; opacity: 0.6;\n        }\n        ",document.head.appendChild(t)}(),setInterval(()=>{const t=document.querySelector(".content");t&&"0px"!==t.style.paddingTop&&(t.style.setProperty("padding-top","0px","important"),t.style.setProperty("height","auto","important"))},1e3),setTimeout(function(){["new_msg","product_description","product_whatsnew"].forEach(t=>{const e=document.getElementById(t);e&&!e.dataset.masterInitialized&&function(t,e){t.dataset.masterInitialized="true";let i=t.value||t.textContent||"";const r=t.closest(".sceditor-container"),c=t.closest(".wysibb"),g=document.createElement("div");g.id="master-root-"+e,g.className="master-editor-container";const b=document.createElement("div");b.id="quill-id-"+e,b.style.height="product_description"===e?"550px":"400px",g.appendChild(b);const x=document.createElement("div");x.className="master-emoji-bar",g.appendChild(x);const f=r||c;f?f.parentNode.replaceChild(g,f):t.parentNode.insertBefore(g,t);t.style.setProperty("display","none","important");const y=document.createElement("input");y.type="hidden",y.name=t.name,y.id="payload-"+e,g.after(y);const v=[[{header:[1,2,!1]}],["bold","italic","underline","strike"],[{color:[]}],["link","product-search","image","video","blockquote"],[{list:"ordered"},{list:"bullet"}],["template-bug","template-access","template-audit","template-hub"],["ai-assist"],["night-mode","clean"]],w=new Quill("#"+b.id,{theme:"snow",placeholder:p(),modules:{uploader:{handler:()=>!1},toolbar:{container:v,handlers:{"template-bug":()=>h(w,"bug_report"),"template-access":()=>h(w,"access_request"),"template-audit":()=>h(w,"audit_report"),"template-hub":()=>h(w,"hub_invite"),"night-mode":()=>g.classList.toggle("dark"),"product-search":()=>function(t,e){let n=document.getElementById("master-product-search");if(n)return void n.remove();n=document.createElement("div"),n.id="master-product-search",n.className="product-search-popup",n.innerHTML='<input type="text" placeholder="–ü–æ–∏—Å–∫ –º–æ–¥—É–ª—è..." id="ps-input" autocomplete="off"><div id="ps-results"></div>',e.appendChild(n);const o=n.querySelector("#ps-input"),i=n.querySelector("#ps-results");let s;o.focus(),o.oninput=()=>{clearTimeout(s),s=setTimeout(async()=>{const e=o.value;if(e.length<2)return;i.innerHTML='<div class="ps-msg">üîé –ò—â—É...</div>';const s=await async function(t){const e=`index.php?route=contact/contact/product_autocomplete&filter_name=${encodeURIComponent(t)}&limit=10&sort_sales=1`;try{const t=await fetch(e);return await t.json()}catch(t){return[]}}(e);i.innerHTML="",s&&0!==s.length?s.forEach(e=>{const o=document.createElement("div");o.className="ps-item",o.innerText=e.name,o.onclick=o=>{o.stopPropagation();const i=t.getSelection(!0);t.focus(),t.insertText(i.index,e.name,"link",e.href),t.setSelection(i.index+e.name.length+1),n.remove()},i.appendChild(o)}):i.innerHTML='<div class="ps-msg">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>'},400)};const r=t=>{n.contains(t.target)||t.target.closest(".ql-product-search")||(n.remove(),document.removeEventListener("mousedown",r))};document.addEventListener("mousedown",r)}(w,g),image:function(){const t=w.getSelection(!0),e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.onchange=()=>{e.files&&e.files.length>0&&k.handleFiles(e.files,t),e.value=""},e.click()},"ai-assist":async function(){let t=w.getSelection(!0);t||(t={index:w.getLength(),length:0});const e=w.getText(t.index,t.length).trim(),n="[–†–æ–±–æ—Ç –¥—É–º–∞–µ—Ç...]";w.insertText(t.index,n,{italic:!0,color:"#01A121"});try{const o=await async function(t){const e=u.getCustomerName(),n=u.getHistory(6),o=[{role:"system",content:`–¢—ã —ç–∫—Å–ø–µ—Ä—Ç OpenCart. –°–æ–±–µ—Å–µ–¥–Ω–∏–∫: ${e}. \n                –í–ê–ñ–ù–û: –û—Ç–≤–µ—á–∞–π —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º –±–µ–∑ Markdown. \n                –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –∂–∏—Ä–Ω—ã–º, –∏—Å–ø–æ–ª—å–∑—É–π —Ç–µ–≥–∏ <b></b>.`},...n,{role:"user",content:t}];return new Promise(t=>{chrome.runtime.sendMessage({type:"ASK_AI",payload:o},e=>{if(e.success&&a)try{e.answer=a.from_bbcode(e.answer)}catch(t){}t(e)})})}(e?`–£–ª—É—á—à–∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç: ${e}`:"–ü—Ä–µ–¥–ª–æ–∂–∏ –≤–µ–∂–ª–∏–≤–æ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞.");w.deleteText(t.index,n.length),o.success&&o.answer?(w.insertText(t.index,o.answer),w.setSelection(t.index+o.answer.length)):alert("AI –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª: "+(o.error||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}catch(e){w.deleteText(t.index,n.length),alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º")}}}},clipboard:{matchVisual:!1,matchers:[[Node.ELEMENT_NODE,(t,e)=>{const n=t.innerText||"";return/rutube\.ru\/video\/|youtube\.com\/watch|youtu\.be\/|vk\.com\/video|vimeo\.com\//.test(n.trim())&&n.trim().length<150?(new s).insert({video:n.trim()}):e}]]}}}),k=new n(w,d),q=new o(w,t=>{const e=w.getSelection(!0);if(!e)return;w.deleteText(e.index-1,1);let n=e.index-1;const o=w.getText(e.index,e.length).trim();m([{role:"system",content:`–¢—ã —ç–∫—Å–ø–µ—Ä—Ç OpenCart. –°–æ–±–µ—Å–µ–¥–Ω–∏–∫: ${u.getCustomerName()}. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π <b></b> –¥–ª—è –∂–∏—Ä–Ω–æ—Å—Ç–∏.`},...u.getHistory(5),{role:"user",content:`${t.task}. ${o?"–ö–æ–Ω—Ç–µ–∫—Å—Ç: "+o:""}`}],t=>{w.insertText(n,t,"api"),n+=t.length,w.selection.scrollIntoView()},()=>{})});if(w.on("text-change",(t,e,n)=>{if("user"===n){const e=t.ops[t.ops.length-1];if(e&&"/"===e.insert&&1===e.insert.length){const t=w.getSelection();if(t&&t.index>0){const e=w.getText(t.index-2,1);if(e&&""!==e.trim())return}q.show()}}}),function(t,e){["‚úÖ","„ÉÑ","‚ú®","‚ö°","‚öñ","‚öô","‚ö†","‚öí","‚òï","‚≠ê","‚ùá","‚ú≥","‚ùó","‚ùì","‚õî","‚úâ","‚úç","‚åö","‚åõ","‚òÄ","‚õÖ","üåô","‚òù","‚úä","‚ò∫","‚òπ"].forEach(n=>{const o=document.createElement("span");o.innerText=n,o.className="emoji-item",o.onclick=e=>{e.preventDefault(),e.stopPropagation();const o=t.getSelection(!0);t.focus(),t.insertText(o.index,n,"user"),t.setSelection(o.index+n.length)},e.appendChild(o)})}(w,x),i&&a)try{const t=a.from_bbcode(i);w.clipboard.dangerouslyPasteHTML(0,t),y.value=a.to_bbcode(w.root.innerHTML)}catch(t){w.setText(i)}w.on("text-change",(e,n,o)=>{if("user"===o||"api"===o){const e=a.to_bbcode(w.root.innerHTML);y.value=e,t.value=e}}),g.addEventListener("mousedown",t=>{t.stopPropagation()},!1),g.addEventListener("focus",t=>{t.stopPropagation()},!0),l[e]=w}(e,t)}),function(){const t=document.getElementById("button-send-message")||document.querySelector('input[onclick*="submit_form"], .button[onclick*="submit"]');if(t&&!t.dataset.hooked){const e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.dataset.hooked="true",e.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),Object.keys(l).forEach(t=>{const e=a.to_bbcode(l[t].root.innerHTML),n=document.getElementById(t);n&&(n.value=e)}),"function"==typeof submit_form?submit_form():document.getElementById("form").submit()})}}(),window.smartQuoterInstance||(window.smartQuoterInstance=new t(l)),window.messageHighlighter||(window.messageHighlighter=new e),window.messageHighlighter.init()},0)})();